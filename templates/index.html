<!doctype html>
{% load humanize %}
<html lang="en">
    <head>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
      <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
      <title>CryptoPiper</title>
    </head>
    <body>
      <nav class="navbar navbar-light bg-light">
          <span class="navbar-brand mb-0 h1">CryptoPiper</span>
      </nav>

        <section class="page-section" id="contact">
            <div class="jumbotron">
              <div class="row">
                <div class="col-lg-12 text-center">
                  <h2 class="section-heading text-uppercase" style="margin-bottom: 2%;">Mining Calculator</h2>
                  <h3 class="section-subheading text-muted"></h3>
                </div>
              </div>
              <div class="row">
                <div class="col-lg-12">
                  <form id="dataForm" method="POST">
                    {% csrf_token %}
                    <div class="form-group col-lg-7">
                        <label for="hashRate" style="width:40% ; margin-left:67%" class="bmd-label-floating">Hash Rate: </label>
                        <input class="form-control" style="width:40% ; margin-left:67%" id="hashRate" name='hashRate' type="number" step="0.01" min="0" value="{{ context.hashRate }}"  placeholder="Hash Power *"
                            required="required" data-validation-required-message="Please enter your hash rate.">
                        <p class="help-block text-danger"></p>
                      </div>
                      <div class="form-group col-lg-7">
                        <label for="power" style="width:40% ; margin-left:67%" class="bmd-label-floating">Power Consumption: </label>
                        <input class="form-control" style="width:40% ; margin-left:67%" id="power" name='power' type="number" step="0.01" min="0" value='{{ context.power }}' placeholder="Power Consumption*"
                            required="required" data-validation-required-message="Please enter your power consumption.">
                        <p class="help-block text-danger"></p>
                      </div> 
                      <div class="form-group col-lg-7">
                          <label for="cost" style="width:40% ; margin-left:67%" class="bmd-label-floating">Cost per KWh: </label>
                          <input class="form-control" style="width:40% ; margin-left:67%" id="cost" name='cost' type="number" step="0.01" min="0" value="{{ context.cost }}" placeholder="Cost per KWh *"
                            required="required" data-validation-required-message="Please enter your cost per KWh.">
                          <p class="help-block text-danger"></p>
                        </div> 
                      
                      <div class="col-lg-12 text-center">
                          <div id="success"></div>
                          <button id="sendMessageButton" class="btn btn-primary btn-raised" type="submit">Calculate</button>
                      </div>
                  </form>
                  <div class="card text-center" style="margin-top: 1rem; margin-left: 43.7%; width: 13rem;">
                        <div class="card-body">
                          <h5 class="card-title"><em>Net Profit:</em></h5>
                          <p id="net_profit" class="card-text" style="font-size: 22px"><strong>{{ context.net_profit|floatformat|intcomma }}</strong></p>
                        </div>
                  </div>
                </div>
              </div>
              <script
                src="https://code.jquery.com/jquery-3.4.1.min.js"
                integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
                crossorigin="anonymous"></script>
              <script>
                var dataForm = {
                  hashRate: $("#hashRate").val(),
                  power: $("#power").val(),
                  cost: $("#cost").val(),
                  csrfmiddlewaretoken: '{{ csrf_token }}',
                }
                function poll() {
                  setTimeout(function() {
                    $.ajax({
                      url: "{% url 'index' %}",
                      data: dataForm,
                      complete: poll,
                      dataType: 'json',
                      success: function(json) {
                        console.log("NET_PROFIT is " + json['net_profit'])
                        netProfit = '<strong>'.concat(json['net_profit'].toFixed(2),'</strong>');
                        $('#net_profit').html(netProfit);
                      },
                    })
                  }, 30000);
                }
              poll();
              </script>
            </div>
          </section>
    </body>
</html>
